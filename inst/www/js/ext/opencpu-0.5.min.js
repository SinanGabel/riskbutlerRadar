window.jQuery||alert("Could not find jQuery! The HTML must include jquery.js before opencpu.js!");
(function(f){function l(a,b,g){this.loc=a;this.key=b;this.txt=g;this.output=g.split(/\r\n|\r|\n/g);this.getKey=function(){return b};this.getLoc=function(){return a};this.getFileURL=function(a){var e=document.createElement("a");e.href=this.getLoc()+"files/"+a;e.username=d.username;e.password=d.password;return e.href};this.getFile=function(a,e){var b=this.getFileURL(a);return f.get(b,e)};this.getObject=function(a,e,b){a=a||".val";a instanceof Function&&(b=a,a=".val");a=this.getLoc()+"R/"+a+"/json";
return f.get(a,e,b)};this.getStdout=function(a){var e=this.getLoc()+"stdout/text";return f.get(e,a)};this.getConsole=function(a){var e=this.getLoc()+"console/text";return f.get(e,a)}}function m(a){this.code=a||"NULL";this.getCode=function(){return a}}function n(a){if(a instanceof File)this.file=a;else if(a instanceof FileList)this.file=a[0];else if(a.files instanceof FileList)this.file=a.files[0];else if(0<a.length&&a[0].files instanceof FileList)this.file=a[0].files[0];else throw'invalid new Upload(file). Argument file must be a HTML <input type="file"></input>';
this.getFile=function(){return a}}function u(a){return a instanceof l?a.getKey():a instanceof m?a.getCode():a instanceof n?a.getFile():a instanceof File?a:a instanceof FileList?a[0]:a&&a.files instanceof FileList?a.files[0]:a&&a.length&&a[0].files instanceof FileList?a[0].files[0]:JSON.stringify(a)}function p(a,b,g){if(!a)throw"r_fun_call called without fun";b=b||{};g=g||function(){};b.url=b.url||d.href+"/"+a;b.type=b.type||"POST";b.data=b.data||{};b.dataType=b.dataType||"text";var c=f.ajax(b).done(function(){var a=
c.getResponseHeader("Location")||console.log("Location response header missing."),b=c.getResponseHeader("X-ocpu-session")||console.log("X-ocpu-session response header missing."),f=c.responseText;r&&a.match("^/[^/]")&&(a=d.protocol+"//"+d.host+a);g(new l(a,b,f))}).fail(function(){console.log("OpenCPU error HTTP "+c.status+"\n"+c.responseText)});return c}function w(a,b,g){return p(a,{data:JSON.stringify(b||{}),contentType:"application/json"},g)}function x(a,b,g){var c={};f.each(b,function(a,b){c[a]=
u(b)});return p(a,{data:f.param(c)},g)}function y(a,b,g){if(void 0===window.FormData)throw alert("Uploading of files requires HTML5. It looks like you are using an outdated browser that does not support this. Please install Firefox, Chrome or Internet Explorer 10+"),"HTML5 required.";var c=new FormData;f.each(b,function(a,b){c.append(a,u(b))});return p(a,{data:c,cache:!1,contentType:!1,processData:!1},g)}function t(a,b,g){b=b||{};var c=!1,e=!1;f.each(b,function(a,b){if(b instanceof File||b instanceof
n||b instanceof FileList)c=!0;else if(b instanceof m||b instanceof l)e=!0});return c?y(a,b,g):e?x(a,b,g):w(a,b,g)}function v(a){if(a.data("ocpuplot"))return a.data("ocpuplot");var b=function(){function b(){c&&(d=h.width(),q=h.height(),h.css("background-image","url("+c+"graphics/"+e+"/png?width="+d+"&height="+q+")"))}var c,e="last",d,q,h=f("<div />").attr({style:"width: 100%; height:100%; min-width: 100px; min-height: 100px; position:relative; background-repeat:no-repeat; background-size: 100% 100%;"}).appendTo(a).css("background-image",
"none"),k=f("<span />").attr({style:"position: absolute; top: 20px; left: 20px; z-index:1000; font-family: monospace;"}).text("loading...").appendTo(h).hide(),l=f("<a />").attr({target:"_blank",style:"position: absolute; top: 10px; right: 10px; z-index:1000; text-decoration:underline; font-family: monospace;"}).text("pdf").appendTo(h),m=f("<a />").attr({target:"_blank",style:"position: absolute; top: 30px; right: 10px; z-index:1000; text-decoration:underline; font-family: monospace;"}).text("svg").appendTo(h),
n=f("<a />").attr({target:"_blank",style:"position: absolute; top: 50px; right: 10px; z-index:1000; text-decoration:underline; font-family: monospace;"}).text("png").appendTo(h),p=z(function(a){(d!=h.width()||q!=h.height())&&h.is(":visible")&&b()},500);h.on("resize",p);f(window).on("resize",p);return{setlocation:function(a,d){e=d||e;(c=a)?(l.attr("href",c+"graphics/"+e+"/pdf?width=11.69&height=8.27&paper=a4r").show(),m.attr("href",c+"graphics/"+e+"/svg?width=11&height=6").show(),n.attr("href",c+"graphics/"+
e+"/png?width=800&height=600").show(),b()):(l.hide(),m.hide(),n.hide(),h.css("background-image",""))},spinner:k}}();a.data("ocpuplot",b);return b}function z(a,b,g){var c,e=null;return function(){var d=this,f=arguments,h=g&&!e;clearTimeout(e);e=setTimeout(function(){e=null;g||(c=a.apply(d,f))},b);h&&(c=a.apply(d,f));return c}}var r=!1,d=document.createElement("a");d.href="../R";f.fn.rplot=function(a,b,d){var c=v(this);c.setlocation();c.spinner.show();return t(a,b,function(a){c.setlocation(a.getLoc());
d&&d(a)}).always(function(){c.spinner.hide()})};f.fn.graphic=function(a,b){v(this).setlocation(a.getLoc(),b||"last")};window.ocpu=window.ocpu||{};var k=window.ocpu;k.call=t;k.rpc=function(a,b,d){return t(a,b,function(a){a.getObject(function(a){d&&d(a)}).fail(function(){console.log("Failed to get JSON response for "+a.getLoc())})})};k.seturl=function(a){if(a.match("/R$")){d=document.createElement("a");d.href=a;d.href=d.href;if(location.protocol!=d.protocol||location.host!=d.host)if(r=!0,!("withCredentials"in
new XMLHttpRequest))alert("This browser does not support CORS. Try using Firefox or Chrome.");else if(d.username&&d.password){var b=new RegExp(d.host);f.ajaxSetup({beforeSend:function(a,c){if(b.test(c.url)){var e=document.createElement("a");e.href=c.url;c.url=e.protocol+"//"+e.host+e.pathname;c.xhrFields=c.xhrFields||{};c.xhrFields.withCredentials=!0;c.crossDomain=!0;a.setRequestHeader("Authorization","Basic "+btoa(d.username+":"+d.password));console.log("Authenticated request to: "+c.url+" ("+d.username+
", "+d.password+")")}}})}"https:"==location.protocol&&"https:"!=d.protocol&&alert("Page is hosted on HTTPS but using a (non-SSL) HTTP OpenCPU server. This is insecure and most browsers will not allow this.");r?console.log("Setting path to CORS server "+d.href):console.log("Setting path to local (non-CORS) server "+d.href);return f.get(d.href+"/",function(a){console.log("Path updated. Available objects/functions:\n"+a)}).fail(function(a,b,d){alert("Connection to OpenCPU failed:\n"+b+"\n"+a.responseText+
"\n"+d)})}alert("ERROR! Trying to set R url to: "+a+". Path to an OpenCPU R package must end with '/R'")};k.Snippet=m;k.Upload=n;"undefined"==typeof console&&(this.console={log:function(){}})})(jQuery);